<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analyzer - Stock {{ stock_number }} of 10</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Progress Header -->
        <div class="progress-header">
            <h1>ðŸ“ˆ Stock Analysis</h1>
            <p class="progress">Stock {{ stock_number }} of 10</p>
            <p>Instructions: Based on the table of historical data of this stock and the AI suggestion, choose if you would like to buy more of this stock or hold your current possession of this stock, using the buttons below. You can also input a number between 1 and 10 of how confident you are in your selection, where 1 is you are not confident and 10 is you are super confident. Once you click a button you will be redirected to another page with a new stock.</p>
        </div>

        <!-- Stock Information -->
        <div class="stock-header">
            <h2>{{ stock_data.ticker }}</h2>
            <!-- <p class="price">Current Price: ${{ "%.2f"|format(stock_data.current_price) }}</p> -->
        </div>

        <!-- Stock Data Table -->
        <div class="box">
            <h3>ðŸ“Š Historical Data (Last 10 Days)</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Open</th>
                            <th>High</th>
                            <th>Low</th>
                            <th>Close</th>
                            <th>Volume</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in range(stock_data.open|length) %}
                        <tr>
                            <td>{{ i + 1 }}</td>
                            <td>${{ "%.2f"|format(stock_data.open[i]) }}</td>
                            <td>${{ "%.2f"|format(stock_data.high[i]) }}</td>
                            <td>${{ "%.2f"|format(stock_data.low[i]) }}</td>
                            <td>${{ "%.2f"|format(stock_data.close[i]) }}</td>
                            <td>{{ "{:,}".format(stock_data.volume[i]|int) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- AI Suggestion Box -->
        <div class="box ai-box">
            <h3>ðŸ¤– AI Suggestion</h3>
            <div class="suggestion-content">
                <div class="suggestion-badge {{ stock_data.ai_suggestion|lower }}">
                    {{ stock_data.ai_suggestion }}
                </div>
                <div class="prediction-info">
                    <p><strong>AI Predicted Next Open:</strong> ${{ "%.2f"|format(stock_data.ai_prediction) }}</p>
                    <!-- <p><strong>Previous Open:</strong> ${{ "%.2f"|format(stock_data.previous_open) }}</p> -->
                    <!-- <p><strong>Current Price:</strong> ${{ "%.2f"|format(stock_data.current_price) }}</p> -->
                </div>
            </div>
        </div>

        <!-- Decision Form -->
        <div class="decision-section">
            <h3>What would you do?</h3>
            <form method="POST" action="/decision" id="decisionForm">
                <!-- Hidden fields to pass data -->
                <input type="hidden" name="stock_number" value="{{ stock_number }}">
                <input type="hidden" name="ticker" value="{{ stock_data.ticker }}">
                <input type="hidden" name="previous_open" value="{{ stock_data.previous_open }}">
                <input type="hidden" name="current_price" value="{{ stock_data.current_price }}">
                <input type="hidden" name="ai_suggestion" value="{{ stock_data.ai_suggestion }}">
                <input type="hidden" name="ai_prediction" value="{{ stock_data.ai_prediction }}">

                <!-- Confidence Rating -->
                <div class="confidence-input">
                    <label for="user_confidence">Confidence (1-10):</label>
                    <p>Instructions: Enter a integer from 1 to 10 on how confident you are with your decision to buy or hold this stock.</p>
                    <input type="number" id="user_confidence" name="user_confidence" 
                        min="1" max="10" value="5" required>
                </div>

                <!-- Decision Buttons -->
            <div class="button-group">
                <button onclick="submitDecision('BUY')" class="btn btn-buy">
                    BUY
                </button>
                <button onclick="submitDecision('HOLD')" class="btn btn-hold">
                    HOLD
                </button>
            </div>
            </form>
        </div>
    </div>

    <script>
        function submitDecision(decision) {
            const formData = new FormData();
            
            // Add all fields
            formData.append('stock_number', '{{ stock_number }}');
            formData.append('ticker', '{{ stock_data.ticker }}');
            formData.append('previous_open', '{{ stock_data.previous_open }}');
            formData.append('current_price', '{{ stock_data.current_price }}');
            formData.append('ai_suggestion', '{{ stock_data.ai_suggestion }}');
            formData.append('ai_prediction', '{{ stock_data.ai_prediction }}');
            formData.append('user_decision', decision);
            
            const confidence = document.getElementById('user_confidence').value;
            formData.append('user_confidence', confidence);
            
            console.log('Submitting:', Object.fromEntries(formData));
            
            // Submit
            fetch('/decision', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                }
                return response.json();
            })
            .then(data => console.log('Response:', data))
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>